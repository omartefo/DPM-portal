<div class="w-full p-8">
	<mat-card class="table-card">
		<div class="container">
			<div class="table-main-header">
				<div class="title-section flex items-center">
					<h2 class="text-3xl font-semibold tracking-tight leading-8 mr-3"> Bidders Pricing </h2>

					<div class="search-field flex-1">
						<mat-form-field class="flex-1">
							<input type="text" placeholder="Search by Company" matInput [formControl]="searchFC">
						</mat-form-field>
					</div>
				</div>
	
				<div class="flex flex-1 justify-end">
					<div class="row-actions mr-3" *ngIf="selectedRow">
						<button mat-button color="primary" class="action"
							(click)="onAwardTender()">
							Award Tender
						</button>
					</div>
			
					<button mat-stroked-button (click)="exportToExcel()" class="mr-3">
						<mat-icon>download</mat-icon>
					</button>

					<button mat-stroked-button (click)="loadData()">
						<mat-icon>refresh</mat-icon>
					</button>
				</div>
			</div>
	
			<div class="table">
				<div>
					<table mat-table [dataSource]="dataSource">
						<ng-container matColumnDef="company">
							<th mat-header-cell *matHeaderCellDef> Company </th>
							<td mat-cell *matCellDef="let element"> {{element.user?.company?.name }} </td>
						</ng-container>
	
						<ng-container matColumnDef="duration">
							<th mat-header-cell *matHeaderCellDef> Duration (months) </th>
							<td mat-cell *matCellDef="let element"> {{element.durationInNumbers }} </td>
						</ng-container>
	
						<ng-container matColumnDef="price">
							<th mat-header-cell *matHeaderCellDef> Price </th>
							<td mat-cell *matCellDef="let element"> {{element.priceInNumbers }} </td>
						</ng-container>

						<ng-container matColumnDef="stage">
							<th mat-header-cell *matHeaderCellDef>
								<span class="relative">
									<span class="mr-4">Stage</span>

									<mat-icon (click)="toggleStageFilter = !toggleStageFilter" 
											class="filter-icon"
											color="primary">
										{{ stageFilterOptions.selectedFilterValue ? 'filter_alt' : 'filter_list' }}
									</mat-icon>
								</span>

								<table-filters *ngIf="toggleStageFilter"
									[config]="stageFilterOptions"
									(signal)="onFilter($event, 'stage')">
								</table-filters>
							</th>
							<td mat-cell *matCellDef="let element">
								<mat-form-field appearance="outline" class="w-40 stage-dropdown">
									<mat-select
										placeholder="Select"
										[value]="element.stage || ''" 
										(selectionChange)="onStageChange(element, $event.value)"
										(click)="$event.stopPropagation()"
									>
										<mat-option value="">None</mat-option>
										<mat-option 
											*ngFor="let option of stageFilterOptions.options" 
											[value]="option">{{ option }}
										</mat-option>
									</mat-select>
								</mat-form-field>
							</td>
						</ng-container>

						<ng-container matColumnDef="isVerifiedOnBinaa">
							<th mat-header-cell *matHeaderCellDef> Binaa Verified</th>
							<td mat-cell *matCellDef="let element">
								<img 
									[src]="'/assets/images/binaa_logo.png'" 
									alt="Binaa Verified" 
									*ngIf="element?.user?.company?.isVerifiedOnBinaa">
							</td>
						</ng-container>
	
						<ng-container matColumnDef="status">
							<th mat-header-cell *matHeaderCellDef>
								<span class="relative">
									<span class="mr-4">Status</span>

									<mat-icon (click)="toggleRangeFilter = !toggleRangeFilter" 
											class="filter-icon"
											color="primary">
										{{ rangeFilterOptions.selectedFilterValue ? 'filter_alt' : 'filter_list' }}
									</mat-icon>
								</span>

								<table-filters *ngIf="toggleRangeFilter"
									[config]="rangeFilterOptions"
									(signal)="onFilter($event)">
								</table-filters>
							</th>

							<td mat-cell *matCellDef="let element">
								<div class="bid-status" [class]="element.status.toLowerCase()">
									{{element.status | replaceUnderscore }}
								</div>
							</td>
						</ng-container>

						<ng-container matColumnDef="dummy_column_take_space">
							<th mat-header-cell *matHeaderCellDef></th>
							<td mat-cell *matCellDef="let element"></td>
						</ng-container>
	
						<ng-container matColumnDef="loading">
							<th mat-header-cell *matHeaderCellDef colspan="100%" style="border-bottom-width: 0; padding: 0;" >
								<mat-progress-bar *ngIf="loading" color="warn" mode="query"></mat-progress-bar>
							</th>
						</ng-container>
	
						<ng-container matColumnDef="error">
							<td class="error-cell" mat-cell *matCellDef="let row" colspan="100%">
								<h3 class="error-title">{{row.title}}</h3>
								<p class="error-msg" *ngIf="row.message">{{row.message}}</p>
							</td>
						</ng-container>
						
						<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true;"></tr>
						<tr mat-header-row *matHeaderRowDef="['loading']; sticky: true;" style="height: 3px !important;"></tr>
						<tr mat-row *matRowDef="let row; columns: ['error']; when: showError"></tr>
					
						<tr mat-row *matRowDef="let row; columns: displayedColumns;" 
							[class.selected]="row === selectedRow"
							style="cursor: pointer;" (click)="onRowClick(row)">
						</tr>
					</table>

					<mat-paginator class="paginator"
						[pageSize]="limit" 
						[pageSizeOptions]="pageSizeOptions" 
						[length]="totalRecords"
						(page)="onPageChange($event)">
					</mat-paginator>
				</div>
			</div>
		</div>
	</mat-card>
</div>
